######################################
# üöÄ BHARATCOMFORT11 ‚Äî Production Config (Fixed)
######################################

[build]
  command = "npm run build"
  publish = ".next"

######################################
# ‚öôÔ∏è Netlify Function Settings
######################################
[functions]
  node_bundler = "esbuild"
  external_node_modules = [
    "firebase-admin",
    "firebase",
    "nodemailer",
    "razorpay",
    "jspdf",
    "jspdf-autotable"
  ]
  included_files = [
    "lib/**/*",
    "app/api/**/*",
    "lib/invoices/**/*"
  ]

######################################
# üß© Next.js Plugin (Handles SSR + API Routes)
######################################
[[plugins]]
  package = "@netlify/plugin-nextjs"

######################################
# üåç Environment Settings
######################################
[build.environment]
  NODE_VERSION = "18"
  NEXT_DISABLE_ENV_INJECTION = "true"
  FIREBASE_CONFIG = "true"
  TZ = "Asia/Kolkata"

######################################
# ‚úÖ Notes
######################################
# Do NOT add any [[redirects]] here.
# The official Next.js Netlify plugin automatically sets up:
#   ‚Ä¢ /api/* ‚Üí /.netlify/functions/next_api
#   ‚Ä¢ SSR + ISR routing
# Custom redirects like "/* ‚Üí /index.html" break dynamic routes and APIs.

# ‚úÖ Example health endpoint test:
# After deployment, visit:
#   https://your-site.netlify.app/api/auth/session
# Expected output: { "error": "Missing token" }
