name: ğŸ› ï¸ Auto-Fix Dynamic API Routes (BHARATCOMFORT11)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: write

jobs:
  fix-dynamic-routes:
    name: ğŸ”§ Scan & Patch Dynamic API Routes
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ§© Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ğŸš€ Run Dynamic Route Fix Script
        run: |
          echo "ğŸ“‚ Installing dependencies..."
          npm install --legacy-peer-deps || true

          echo "âš™ï¸ Running auto-fix script..."
          node fix-all-dynamic-routes.cjs || echo "No changes needed."

      - name: ğŸ’¾ Commit & Push Fixes (if any)
        run: |
          git config user.name "BharatComfort11 AutoBot"
          git config user.email "autobot@bharatcomfort11.dev"
          git add .
          if git diff --cached --quiet; then
            echo "âœ… No changes to commit."
          else
            git commit -m "fix: auto-added dynamic route markers (force-dynamic + nodejs runtime)"
            git push origin main
          fi
